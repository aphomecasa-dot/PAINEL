<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Dashboard Ajustado</title>

<link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet" />

<style>
:root {
    --bg: #0d0d0d;
    --card: #151515;
    --accent: #00aaff;
    --text: #ffffff;
    --sub: #b0b0b0;
    --radius: 18px;
    --shadow: 0 0 20px #0008;
    --sun: #ff4d4d;
    --sat: #4da6ff;
    --week: #ffffff;
    --highlight-day-bg: #2ea85a;
}

body {
    margin: 0;
    background: url(teste2.png) no-repeat center center fixed !important;
    background-size: cover !important;
    color: var(--text);
    font-family: "Segoe UI", sans-serif;
    overflow: hidden;
}

.layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 160px 180px 1fr; /* antigo */
    grid-template-rows: 160px 180px 300px; /* ajuste: altura fixa menor para os calendários */
    gap: 22px 25px;
    padding: 25px;
    height: 100vh;
    box-sizing: border-box;
}

/* Limitando altura dos calendários */
#cal-current, #cal-next {
    max-height: calc(100% - 30px); /* deixa 30px de espaço inferior */
    overflow: auto; /* caso o conteúdo ultrapasse, barra de rolagem */
}





/* Quadrante do clima */
.top-left {
    background: transparent;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    position: relative;
    padding: 25px 35px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;

    grid-column: 1 / 2;
    grid-row: 1 / 2;
}

/* Quadrante da hora/data */
.top-right {
    background: transparent;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    position: relative;
    padding: 25px 35px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;

    grid-column: 2 / 3;
    grid-row: 1 / 3;
}

td.sunday span { color: var(--sun); }      /* Domingo em vermelho */
td.saturday span { color: var(--sat); }    /* Sábado em azul */
td.sunday span { color: red; }
td.saturday span { color: blue; }
td.today span { background: #ffffff; color: #000; }
/* Canvas sobreposto */
#top-left-effect,
#top-right-effect {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    border-radius: var(--radius);
    z-index: 0;
}

/* Conteúdo acima do canvas */
.top-left-content > *,
.top-right-content > * {
    position: relative;
    z-index: 1;
}


.top-right-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    height: 100%; /* importante para que margin-top: auto funcione */
}


/* Relógio e data */
#clock {
    font-size: 110px;
    font-weight: 700;
    line-height: 1;
}

#date {
    font-size: 28px;
    font-weight: 700;
    margin-top: 8px;
    color: #ffffff;
    text-transform: uppercase;
}

/* Cotação */
#currency-section {
    margin-top: auto;
    font-size: 24px;
    display: flex;
    justify-content: center; /* centraliza horizontalmente */
    gap: 40px; /* mantém o espaçamento entre USD e EUR */
}

/* CLIMA ATUAL */
#weather-now-row {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    width: 100%;
}

/* Dia (EX: 05-JAN) */
#weather-now-day {
    font-size: 45px;
    color: #ffffff;
}

/* Bloco de temperatura */
.weather-temp-block {
    display: flex;
    align-items: center;
    gap: 8px;
}

#weather-icon {
    font-size: 72px;
}

#weather-now {
    font-size: 72px;
    font-weight: 700;
}

/* PREVISÃO */
#forecast-section {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    padding: 10px 30px;
    grid-column: 1 / 2;
    grid-row: 2 / 3;
    background: transparent;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid rgba(255,255,255,0.15);
}

.forecast-item-horizontal {
    flex: 1;
    background-color: rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
}

.forecast-icon-horizontal { font-size: 32px; }
.forecast-day-horizontal { font-size: 18px; margin-top: 6px; }
.forecast-temp-horizontal { font-size: 22px; font-weight: 700; margin-top: 4px; }

/* Calendários */
.card-calendar {
    background: transparent;
    box-shadow: var(--shadow);
    border-radius: var(--radius);
    padding: 25px 30px;
    color: var(--accent);
    font-weight: 600;
}

#cal-current { grid-column: 1 / 2; grid-row: 3 / 5; }
#cal-next { grid-column: 2 / 3; grid-row: 3 / 5; }

.card-calendar h2 {
    font-size: 24px;
    color: var(--accent);
    text-align: center;
    margin-bottom: 18px;
}

/* Calendário tabela */
table {
    width: 100%;
    text-align: center;
    border-collapse: collapse;
    font-size: 26px;
    color: var(--text);
}

th {
    padding: 10px 0;
    font-size: 20px;
    color: var(--sub);
}

td {
    padding: 10px 0;
    font-size: 30px;
    border-radius: 50%;
    transition: 0.2s;
}

td:hover { transform: scale(1.2); background: #2a2a2a; }

td.today span {
    background: #ffffff;
    color: #000;
    width: 40px; height: 40px;
    display: flex; justify-content: center; align-items: center;
    border-radius: 50%;
}
</style>
</head>
<body>

<div class="layout">

    <!-- ==============================================
         CLIMA ATUAL — (TOPO ESQUERDO)
    =============================================== -->
  <div id="top-left" class="top-left">

    <!-- Canvas do clima -->
    <canvas id="top-left-effect"></canvas>

    <!-- Conteúdo -->
    <div class="top-left-content" style="width:100%; display:flex; justify-content:center;">

        <!-- Linha do clima -->
        <div id="weather-now-row"
             style="display:flex; flex-direction:row; justify-content:space-between; align-items:flex-end; width:100%;">

            <!-- Dia (extrema esquerda) -->
            <span id="weather-now-day"
                  style="font-size:72px; font-weight:700; margin:0; padding:0;">
            </span>

            <!-- Bloco à direita -->
            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">

                <!-- Descrição -->
                <div id="weather-description"
                     style="font-size:26px; color:#ffffff; text-align:right; line-height:1;">
                </div>

                <!-- Ícone + Temperatura -->
                <div class="weather-temp-block"
                     style="display:flex; flex-direction:row; align-items:center; gap:8px; margin:0;">

                    <span id="weather-icon" class="weather-now-icon mdi" style="font-size:72px;"></span>
                    <span id="weather-now" style="font-size:72px; font-weight:700;"></span>

                </div>

            </div>

        </div>

    </div>
</div>




    <!-- ==============================================
         HORA, DATA E COTAÇÃO — (TOPO DIREITO)
    =============================================== -->
    <div id="top-right" class="top-right">

        <canvas id="top-right-effect"></canvas>

        <div class="top-right-content">

            <div>
                <div id="clock">--:--:--</div>
                <div id="date">Carregando...</div>
            </div>

            <div id="currency-section">
                <div id="usd">USD: ...</div>
                <div id="eur">EUR: ...</div>
            </div>

        </div>
    </div>



    <!-- PREVISÃO -->
    <section id="forecast-section"></section>

    <!-- CALENDÁRIOS -->
    <section id="cal-current" class="card-calendar">
        <h2 id="current-month-title">Mês Atual</h2>
        <div id="cal1"></div>
    </section>

    <section id="cal-next" class="card-calendar">
        <h2 id="next-month-title">Próximo Mês</h2>
        <div id="cal2"></div>
    </section>

</div>




<script>
/* RELÓGIO */
function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText =
        now.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit", second: "2-digit" });

    document.getElementById("date").innerText =
        now.toLocaleDateString("pt-BR", { weekday: "long", day: "2-digit", month: "long" }).toUpperCase();
}
setInterval(updateClock, 1000);
updateClock();

/* MESES */
const monthNames = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

const dow = [
    { l: "DOM", c: "var(--sun)" },
    { l: "SEG", c: "var(--week)" },
    { l: "TER", c: "var(--week)" },
    { l: "QUA", c: "var(--week)" },
    { l: "QUI", c: "var(--week)" },
    { l: "SEX", c: "var(--week)" },
    { l: "SÁB", c: "var(--sat)" },
];

function createCalendar(target, offset) {
    const d = new Date();
    d.setMonth(d.getMonth() + offset);
    const y = d.getFullYear();
    const m = d.getMonth();

    document.getElementById(
        offset === 0 ? "current-month-title" : "next-month-title"
    ).innerText = monthNames[m];

    const firstDay = new Date(y, m, 1).getDay(); // 0=domingo
    const totalDays = new Date(y, m + 1, 0).getDate();

    let html = "<table><tr>";

    // Cabeçalho
    dow.forEach(w => html += `<th style="color:${w.c}">${w.l}</th>`);
    html += "</tr><tr>";

    // td vazios antes do dia 1
    for (let i = 0; i < firstDay; i++) html += "<td></td>";

    const now = new Date();
    const isCurrentMonth = (offset === 0 && now.getMonth() === m);

    let dayOfWeekCounter = firstDay;

    for (let day = 1; day <= totalDays; day++) {
        let cls = "";
        if (isCurrentMonth && now.getDate() === day) cls = "today";

        let style = "";
        if (dayOfWeekCounter % 7 === 0) style = "color:red;";   // Domingo
        if (dayOfWeekCounter % 7 === 6) style = "color:blue;";  // Sábado

        html += `<td class="${cls}" style="${style}"><span>${day}</span></td>`;

        dayOfWeekCounter++;
        if (dayOfWeekCounter % 7 === 0) html += "</tr><tr>";
    }

    html += "</tr></table>";

    document.getElementById(target).innerHTML = html;
}




createCalendar("cal1", 0);
createCalendar("cal2", 1);

/* ÍCONES DO CLIMA */
function weatherIcon(code) {
    const map = {
        "Clear": "mdi-weather-sunny",
        "Clouds": "mdi-weather-cloudy",
        "Rain": "mdi-weather-rainy",
        "Drizzle": "mdi-weather-partly-rainy",
        "Thunderstorm": "mdi-weather-lightning",
        "Snow": "mdi-weather-snowy",
        "Mist": "mdi-weather-fog",
        "Fog": "mdi-weather-fog"
    };
    return map[code] || "mdi-weather-cloudy";
}

/* CORES DA TEMPERATURA */
function setTempColor(temp) {
    const tempEl = document.getElementById("weather-now");
    const iconEl = document.getElementById("weather-icon");

    if (temp > 25) {
        tempEl.style.color = iconEl.style.color = "#FF8C00"; // laranja escuro
    } else if (temp >= 20) {
        tempEl.style.color = iconEl.style.color = "#FFFF00"; // amarelo
    } else {
        tempEl.style.color = iconEl.style.color = "#00aaff"; // azul
    }
}


/* ANIMAÇÃO DO CLIMA — NUVENS / CHUVA */
function showWeatherEffectOnCanvas(condition, canvasId) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext("2d");

    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    /* CHUVA */
    if (condition === "Rain" || condition === "Drizzle") {
        const drops = [];

        for (let i=0; i<140; i++) {
            drops.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height,
                len: Math.random()*20+10,
                speed: Math.random()*4+4
            });
        }

        function rain() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.strokeStyle = "rgba(180,220,255,0.6)";
            ctx.lineWidth = 2;

            drops.forEach(d=>{
                ctx.beginPath();
                ctx.moveTo(d.x, d.y);
                ctx.lineTo(d.x, d.y+d.len);
                ctx.stroke();

                d.y += d.speed;
                if (d.y > canvas.height) d.y = -20;
            });

            requestAnimationFrame(rain);
        }
        rain();
        return;
    }

    /* NUVENS */
    if (condition === "Clouds") {
        const clouds = [];

        for (let i=0;i<6;i++) {
            clouds.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height*0.6,
                w: Math.random()*180+120,
                h: Math.random()*60+40,
                speed: Math.random()*0.4+0.2
            });
        }

        function cloudsMove() {
            ctx.clearRect(0,0,canvas.width,canvas.height);

            clouds.forEach(c=>{
                ctx.fillStyle = "rgba(255,255,255,0.25)";
                ctx.beginPath();
                ctx.ellipse(c.x, c.y, c.w, c.h, 0, 0, Math.PI*2);
                ctx.fill();

                ctx.fillStyle = "rgba(255,255,255,0.18)";
                ctx.beginPath();
                ctx.ellipse(c.x + c.w*0.3, c.y - 20, c.w*0.7, c.h*0.8, 0, 0, Math.PI*2);
                ctx.fill();

                ctx.fillStyle = "rgba(255,255,255,0.15)";
                ctx.beginPath();
                ctx.ellipse(c.x - c.w*0.2, c.y - 10, c.w*0.6, c.h*0.7, 0, 0, Math.PI*2);
                ctx.fill();

                c.x += c.speed;
                if (c.x - c.w > canvas.width) c.x = -c.w;
            });

            requestAnimationFrame(cloudsMove);
        }
        cloudsMove();
        return;
    }
}

/* CLIMA */
const LAT = -23.5270;
const LON = -46.7260;
const API_KEY = "a1914a0291e97791460f4558d57cf359";

async function loadWeather() {
    try {
        const nowRes = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&units=metric&lang=pt_br&appid=${API_KEY}`
        );
        const now = await nowRes.json();

        const temp = Math.round(now.main.temp);

        document.getElementById("weather-now").innerText = `${temp}°C`;

        /* Ícone do clima atual com cores conforme condição */
        const weatherNowMain = now.weather[0].main;
        let iconColor;
        if (weatherNowMain === "Rain" || weatherNowMain === "Drizzle") iconColor = "#00aaff"; // azul
        else if (weatherNowMain === "Clear") iconColor = "#FFFF00"; // amarelo
        else iconColor = "#cccccc"; // nublado ou outros

        const iconEl = document.getElementById("weather-icon");
        iconEl.className = "weather-now-icon mdi " + weatherIcon(weatherNowMain);
        iconEl.style.color = iconColor;

        document.getElementById("weather-description").innerText =
            now.weather[0].description.toUpperCase();

        const date = new Date();
        document.getElementById("weather-now-day").innerText =
            `${String(date.getDate()).padStart(2,"0")}-${date.toLocaleDateString("pt-BR",{month:"short"}).replace(".","").toUpperCase()}`;

        /* Ajusta cor do número da temperatura */
        setTempColor(temp);

        const condition = now.weather[0].main;
        showWeatherEffectOnCanvas(condition, "top-left-effect");
        showWeatherEffectOnCanvas(condition, "top-right-effect");

        /* PREVISÃO */
        const fRes = await fetch(
            `https://api.openweathermap.org/data/2.5/forecast?lat=${LAT}&lon=${LON}&units=metric&lang=pt_br&appid=${API_KEY}`
        );
        const fJson = await fRes.json();

        const fDiv = document.getElementById("forecast-section");
        fDiv.innerHTML = "";

        const list = fJson.list;
        const daily = [];

        for (let i = 1; i <= 5; i++) {
            const target = new Date();
            target.setDate(target.getDate() + i);
            target.setHours(12, 0, 0, 0);

            let best = null, diffMin = Infinity;
            list.forEach(item => {
                const dt = new Date(item.dt * 1000);
                const diff = Math.abs(dt - target);
                if (diff < diffMin) {
                    diffMin = diff;
                    best = item;
                }
            });
            daily.push(best);
        }

        daily.forEach(day => {
            const dt = new Date(day.dt * 1000);
            const t = Math.round(day.main.temp);

            /* Cor da temperatura */
            let col;
            if (t > 25) col = "#FF8C00";      // laranja escuro
            else if (t >= 20) col = "#FFFF00"; // amarelo
            else col = "#00aaff";              // azul

            /* Cor do ícone da previsão baseado na condição daquele dia */
            const mainCond = day.weather[0].main;
            let iconCol;
            if (mainCond === "Rain" || mainCond === "Drizzle") iconCol = "#00aaff"; // azul
            else if (mainCond === "Clear") iconCol = "#FFFF00"; // amarelo
            else iconCol = "#cccccc"; // cinza (nublado ou outros)

            fDiv.innerHTML += `
                <div class="forecast-item-horizontal">
                    <span class="forecast-icon-horizontal mdi ${weatherIcon(mainCond)}" style="color:${iconCol} !important;"></span>
                    <div class="forecast-day-horizontal">
                        ${dt.toLocaleDateString("pt-BR",{weekday:"short"}).toUpperCase()}
                    </div>
                    <div class="forecast-temp-horizontal" style="color:${col}">
                        ${t}°C
                    </div>
                </div>
            `;
        });

    } catch (err) {
        console.error("ERRO NO CLIMA:", err);
    }
}


loadWeather();
setInterval(loadWeather, 300000);

/* COTAÇÃO */
function loadCurrency() {
    fetch("https://economia.awesomeapi.com.br/json/last/USD-BRL")
        .then(r => r.json())
        .then(d => {
            document.getElementById("usd").innerText =
                `USD: R$ ${Number(d.USDBRL.bid).toFixed(2)}`;
        });

    fetch("https://economia.awesomeapi.com.br/json/last/EUR-BRL")
        .then(r => r.json())
        .then(d => {
            document.getElementById("eur").innerText =
                `EUR: R$ ${Number(d.EURBRL.bid).toFixed(2)}`;
        });
}
loadCurrency();
setInterval(loadCurrency, 60000);
</script>

</body>
</html>
